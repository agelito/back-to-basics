
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.2">
    
    
      
        <title>3. Creating a Window - Back to Basics</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creating-a-window" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Back to Basics" class="md-header__button md-logo" aria-label="Back to Basics" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Back to Basics
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. Creating a Window
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Back to Basics" class="md-nav__button md-logo" aria-label="Back to Basics" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Back to Basics
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1_hello_world/" class="md-nav__link">
        1. Hello World
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../2_build_system/" class="md-nav__link">
        2. Build System
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          3. Creating a Window
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        3. Creating a Window
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing-sdl2" class="md-nav__link">
    Installing SDL2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replacing-hello-world" class="md-nav__link">
    Replacing Hello World
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initializing-sdl2-video-subsystem" class="md-nav__link">
    Initializing SDL2 Video Subsystem
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-window" class="md-nav__link">
    Creating the window
  </a>
  
    <nav class="md-nav" aria-label="Creating the window">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#game_windowh" class="md-nav__link">
    game_window.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#game_windowc" class="md-nav__link">
    game_window.c
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mainc" class="md-nav__link">
    main.c
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-diff-for-this-chapter" class="md-nav__link">
    Full diff for this chapter
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing-sdl2" class="md-nav__link">
    Installing SDL2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replacing-hello-world" class="md-nav__link">
    Replacing Hello World
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initializing-sdl2-video-subsystem" class="md-nav__link">
    Initializing SDL2 Video Subsystem
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-window" class="md-nav__link">
    Creating the window
  </a>
  
    <nav class="md-nav" aria-label="Creating the window">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#game_windowh" class="md-nav__link">
    game_window.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#game_windowc" class="md-nav__link">
    game_window.c
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mainc" class="md-nav__link">
    main.c
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-diff-for-this-chapter" class="md-nav__link">
    Full diff for this chapter
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="creating-a-window">Creating a Window</h1>
<p>Now it's time to move away from just plain terminal hello world and create a window. To display a window we'll be using the SDL2 library. </p>
<blockquote>
<p>Simple DirectMedia Layer is a cross-platform development library designed to provide low level access to audio, keyboard, mouse, joystick, and graphics hardware via OpenGL and Direct3D. It is used by video playback software, emulators, and popular games including Valve's award winning catalog and many Humble Bundle games. - https://github.com/libsdl-org/SDL</p>
</blockquote>
<h2 id="installing-sdl2">Installing SDL2</h2>
<p>Installing <code>SDL2</code> is easy on most Linux distributions. most package repositories already contains the library.</p>
<pre><code class="language-sh">pacman -S sdl2
</code></pre>
<h2 id="replacing-hello-world">Replacing Hello World</h2>
<p>We'll start by removing the <code>src/chello_world.c</code> example code and instead create <code>src/main.c</code> this will be our entrypoint from now on, where the code starts executing when the user run our game.</p>
<pre><code class="language-sh">rm src/hello_world.c
</code></pre>
<p>Create the new <code>src/main.c</code> file with empty main function:</p>
<pre><code class="language-c">int main(int argc, char* argv[]) {
    return 0;
}
</code></pre>
<p>We'll also have to update our <code>CMakeLists.txt</code> to include SDL2 library and use our new <code>src/main.c</code>.</p>
<p>First we'll remove the old <code>hello_world</code> executable. Just remove the line</p>
<pre><code class="language-cmake">add_executable(hello_world src/hello_world.c)
</code></pre>
<p>Next to tell cmake to find the SDL2 header files and library files add these lines to the <code>CMakeLists.txt</code>:</p>
<pre><code class="language-cmake">find_package(SDL2 REQUIRED)
include_directories(back_to_basics ${SDL2_INCLUDE_DIRS})
</code></pre>
<p>Finally add the game executable and associated source file:</p>
<pre><code class="language-cmake">add_executable(back_to_basics src/main.c)
target_link_libraries(back_to_basics ${SDL2_LIBRARIES})
</code></pre>
<h2 id="initializing-sdl2-video-subsystem">Initializing SDL2 Video Subsystem</h2>
<p>SDL2 functionality is divided into various subsystems. The only one we're interested in for now is the VIDEO subsystem. Before using any features from the VIDEO subsystem we have to initialize it.</p>
<p>Add the following lines to <code>src/main.c</code>:</p>
<pre><code class="language-c">if (SDL_Init(SDL_INIT_VIDEO) &lt; 0)
{
    printf(&quot;failed initializing SDL2\n&quot;);
    return -1;
}
</code></pre>
<p>We'll also ensure any resources allocated by SDL2 during initialization is properly freed before the application exits. Add the following at the end of <code>main</code> function before the <code>return 0</code> statement.</p>
<pre><code class="language-c">SDL_Quit();
</code></pre>
<p>Now our <code>src/main.c</code> file should look like this:</p>
<pre><code class="language-c">int main(int argc, char* argv[])
{
    if (SDL_Init(SDL_INIT_VIDEO) &lt; 0)
    {
        printf(&quot;failed initializing SDL2\n&quot;);
        return -1;
    }

    SDL_Quit();

    return 0;
}
</code></pre>
<p>Try compiling and running the application making sure there's no mistakes and the <code>failed initializing SDL2</code> message doesn't appear.</p>
<h2 id="creating-the-window">Creating the window</h2>
<p>Now finally it's time to create the window and make it stay open until the user choose to close it. Additionally we're going to ensure the window can be filled with a color.</p>
<p>Start by creating a source file and associated header file to ensue the <code>src/main.c</code> file doesn't get too busy. Separating code into different files helps with maintenance and organization.</p>
<p>Create <code>src/game_window.h</code> and <code>src/game_window.c</code>:</p>
<pre><code class="language-sh">touch src/game_window.h
touch src/game_window.c
</code></pre>
<h3 id="game_windowh">game_window.h</h3>
<p>The initial code inside <code>src/game_window.h</code> will look like this:</p>
<pre><code class="language-c">// game_window.h

#ifndef GAME_WINDOW_INCLUDED
#define GAME_WINDOW_INCLUDED

#include &lt;stdint.h&gt;

typedef struct GameWindow {
    int32_t window_width;
    int32_t window_height;
    int32_t pixel_buffer_width;
    int32_t pixel_buffer_height;
    uint8_t flags;
    uint8_t *pixels;

    struct GameWindowInternal* internal;
} GameWindow;

enum GameWindowFlags {
    GAME_WINDOW_FLAGS_NONE = 0,
    GAME_WINDOW_FLAGS_CLOSED = 1 &lt;&lt; 0,
};

GameWindow* game_window_create();
void game_window_destroy(GameWindow *game_window);
void game_window_process_events(GameWindow *game_window);
void game_window_surface_lock_pixels(GameWindow *game_window);
void game_window_surface_unlock_and_update_pixels(GameWindow *game_window);

#endif // GAME_WINDOW_INCLUDED
</code></pre>
<p>Here we've defined the public <code>struct</code> for keeping track of the window state. There's a there's also a declaration of a <code>struct</code> for holding <code>internal</code> state to keep the <code>SDL2</code> references contained to <code>src/game_window.c</code> file. That way we can choose to replace <code>SDL2</code> in the future without having to modify any other parts of the code.</p>
<p>Additionally there's a field and associated <code>enum</code> for holding <code>flags</code> this state is packed into an eight bit integer which will allow storing eight different states. The <code>enum</code> with state will just have the <code>GAME_WINDOW_FLAGS_CLOSED</code> state for now which will be used to indicate the window has been closed by the user.</p>
<p>Finally there's five declared functions, these functions will be called from the <code>src/main.c</code> file to interact with the window.</p>
<h3 id="game_windowc">game_window.c</h3>
<p>Start by including the necessary header files and defining the <code>GameWindowInternal</code> <code>struct</code>. Add the following to the top of the <code>src/game_window.c</code> file:</p>
<pre><code class="language-c">// game_window.c

#include &quot;game_window.h&quot;

#include &lt;SDL2/SDL.h&gt;
typedef struct GameWindowInternal {
    SDL_Window* window_handle;
    SDL_Surface* surface;
} GameWindowInternal;
</code></pre>
<p>Next for creating our window we'll define the <code>game_window_create</code> function. This function will be responsible for allocating the memory for our <code>GameWindow</code> <code>struct</code> and then using <code>SDL2</code> to create our window. It will also populate the <code>struct</code> with some good initial values.</p>
<pre><code class="language-c">GameWindow* game_window_create(const char* title, int width, int height)
{
    // Tell SDL our window should be resizeable
    uint32_t window_flags = SDL_WINDOW_RESIZABLE;

    // Create the window passing our desired title, position, size, and flags.
    SDL_Window *sdl_window = SDL_CreateWindow(title,
                                          SDL_WINDOWPOS_CENTERED,
                                          SDL_WINDOWPOS_CENTERED,
                                          width, height,
                                          window_flags);

    if (!sdl_window)
    {
        printf(&quot;failed to create window\n&quot;);
        return 0;
    }

    // Allocate memory for the GameWindow and GameWindowInternal structs
    uintptr_t window_and_internal_size = 
        sizeof(GameWindow) + sizeof(GameWindowInternal);
    GameWindow* game_window = malloc(window_and_internal_size);
    game_window-&gt;internal = (GameWindowInternal*)(game_window + 1);

    // Assign initial values to the struct
    game_window-&gt;internal-&gt;window_handle = sdl_window;
    game_window-&gt;internal-&gt;surface = 0;

    game_window-&gt;window_width = width;
    game_window-&gt;window_height = height;
    game_window-&gt;pixel_buffer_width = 0;
    game_window-&gt;pixel_buffer_height = 0;
    game_window-&gt;pixels = 0;
    game_window-&gt;flags = GAME_WINDOW_FLAGS_NONE;

    // Return the pointer to our GameWindow struct.
    return game_window;
}
</code></pre>
<p>Many times in programming symmetry is applied, so when we add a function to create something we'll also want to be able to destroy or free that same thing. Add the <code>game_window_destroy</code> function to <code>src/game_window.c</code>:</p>
<pre><code class="language-c">void game_window_destroy(GameWindow* game_window)
{
    // Tell SDL to destroy our window
    SDL_DestroyWindow(game_window-&gt;internal-&gt;window_handle);
    game_window-&gt;internal-&gt;window_handle = 0;

    // Free the memory we allocated for the GameWindow struct
    free(game_window);
}
</code></pre>
<p>Next up is processing window events. These events is generated by <code>SDL2</code> and should be processed regularly. There's multiple different kind of events but we're only interested in knowing if the user want to close the window or if the window changes size for now. Add the following function to <code>src/game_window.c</code>:</p>
<pre><code class="language-c">void game_window_process_events(GameWindow* game_window)
{
    // Use SDL_PollEvent in a loop to retrieve events until there's no more events available.
    SDL_Event event;
    while(SDL_PollEvent(&amp;event))
    {
        switch(event.type)
        {
            case SDL_WINDOWEVENT:
                if (event.window.event == SDL_WINDOWEVENT_SHOWN) {
                    game_window_update_size(game_window);
                }
                if (event.window.event == SDL_WINDOWEVENT_RESIZED) {
                    game_window_update_size(game_window);
                }
                break;
            case SDL_QUIT:
                game_window-&gt;flags |= GAME_WINDOW_FLAGS_CLOSED;
                break;
        }
    }
}
</code></pre>
<p><code>SDL_PollEvent</code> will look in the queue of events and retrieve the first one and remove it from the queue. We do this in a loop to retrieve all the events until there's none left. This should happen regularly because otherwise the events queue will fill up and window may become unresponsive.</p>
<p>We're using a <code>switch</code> statement to determine what type of event was retrieved. If it was a <code>SDL_WINDOWEVENT</code> we'll check if it was the window being shown or resized, if it was a <code>SDL_QUIT</code> event we'll update the <code>game_window-&gt;flags</code> field to indicate the window was closed.</p>
<p>Above the <code>game_window_process_events</code> function we should add the <code>game_window_update_size</code> function. This function isn't declared in the <code>src/game_window.h</code> header file so it needs to be defined before being used. The function is responsible for reading and updating the window size as well as the underlying pixel buffer size these two may differ due to the screen DPI.</p>
<p>Add the function above <code>game_window_process_events</code>:</p>
<pre><code class="language-c">void game_window_update_size(GameWindow* window)
{
    SDL_GetWindowSize(window-&gt;internal-&gt;window_handle,
                      &amp;window-&gt;window_width,
                      &amp;window-&gt;window_height);

    SDL_Renderer* renderer = 
        SDL_GetRenderer(window-&gt;internal-&gt;window_handle);

    SDL_GetRendererOutputSize(renderer,
                              &amp;window-&gt;pixel_buffer_width,
                              &amp;window-&gt;pixel_buffer_height);
}
</code></pre>
<p>Finally to modify the buffer of pixels we'll have to retrieve a pointer to the memory where it's stored. Aditionally it's best to 'lock' the buffer, this is not applicable to all configurations but doesn't hurt much to do it. Add the following two functions for locking and unlocking the buffer to the end of <code>src/game_window.c</code>:</p>
<pre><code class="language-c">void game_window_surface_lock_pixels(GameWindow* game_window)
{
    // Retrieve pointer to SDL_Surface
    SDL_Surface *surface = 
        SDL_GetWindowSurface(game_window-&gt;internal-&gt;window_handle);

    // Lock the surface
    SDL_LockSurface(surface);

    // Assign internal state as well as the pixels pointer
    game_window-&gt;internal-&gt;surface = surface;
    game_window-&gt;pixels = surface-&gt;pixels;
}

void game_window_surface_unlock_and_update_pixels(GameWindow* game_window)
{
    // Reset the pixels pointer to prevent accidentally writing to it while
    // surface isn't locked.
    game_window-&gt;pixels = 0;

    // Unlock the surface
    SDL_UnlockSurface(game_window-&gt;internal-&gt;surface);

    // Tell SDL2 to redraw the window with content from the pixels buffer
    SDL_UpdateWindowSurface(game_window-&gt;internal-&gt;window_handle);
}
</code></pre>
<p>Now the <code>src/game_window.c</code> file is done and we just have to modify <code>src/main.c</code> to call the functions we've just created.</p>
<h3 id="mainc">main.c</h3>
<p>Since all the window logic is nicely encapsulated inside <code>src/game_window.c</code> we just have to make pretty minor modifications to the <code>src/main.c</code> file. Add the following content to <code>src/main.c</code> between the <code>SDL_Init(SDL_INIT_VIDEO)</code> and <code>SDL_Quit()</code> calls:</p>
<pre><code class="language-c">    GameWindow* game_window = 
        game_window_create(&quot;back_to_basics&quot;, 680, 480);

    // Keep running while the window is open
    while ((game_window-&gt;flags &amp; GAME_WINDOW_FLAGS_CLOSED) == 0)
    {
        // Process the window events
        game_window_process_events(game_window);

        // Lock the window surface pixel buffer
        game_window_surface_lock_pixels(game_window);

        // Write blue color to every pixel
        uint32_t *pixels_32bpp = (uint32_t *)game_window-&gt;pixels;
        for (int y = 0; y &lt; game_window-&gt;pixel_buffer_height; y++)
        {
            uint32_t row = y * game_window-&gt;pixel_buffer_width;
            for (int x = 0; x &lt; game_window-&gt;pixel_buffer_width; x++)
            {
                pixels_32bpp[x + row] = 0xff0000ff;
            }
        }

        // Unlock the pixel buffer and update window
        game_window_surface_unlock_and_update_pixels(game_window);

        // Wait 10 milliseconds so the CPU isn't working all the time
        SDL_Delay(10);
    }
</code></pre>
<p>Compiling and running the code now should display a window filled with blue color. Don't forget to commit the changes using <code>git</code> after verifying all the code is working properly.</p>
<h2 id="full-diff-for-this-chapter">Full diff for this chapter</h2>
<pre><code class="language-diff">modified   .vscode/launch.json
@@ -6,7 +6,7 @@
             &quot;type&quot;: &quot;cppdbg&quot;,
             &quot;request&quot;: &quot;launch&quot;,
             &quot;name&quot;: &quot;Launch Application&quot;,
-            &quot;program&quot;: &quot;${workspaceRoot}/build/hello_world&quot;,
+            &quot;program&quot;: &quot;${workspaceRoot}/build/back_to_basics&quot;,
             &quot;cwd&quot;: &quot;${workspaceRoot}&quot;,
             &quot;preLaunchTask&quot;: &quot;${defaultBuildTask}&quot;,
         }
modified   CMakeLists.txt
@@ -4,4 +4,8 @@ project(back_to_basics)
 set(CMAKE_C_COMPILER /usr/bin/clang)
 set(CMAKE_C_STANDARD 11)

-add_executable(hello_world src/hello_world.c)
+find_package(SDL2 REQUIRED)
+include_directories(back_to_basics ${SDL2_INCLUDE_DIRS})
+
+add_executable(back_to_basics src/main.c src/game_window.c)
+target_link_libraries(back_to_basics ${SDL2_LIBRARIES})
new file   src/game_window.c
@@ -0,0 +1,104 @@
+// game_window.c
+
+#include &quot;game_window.h&quot;
+
+#include &lt;SDL2/SDL.h&gt;
+typedef struct GameWindowInternal {
+    SDL_Window* window_handle;
+    SDL_Surface* surface;
+} GameWindowInternal;
+
+void game_window_update_size(GameWindow* window)
+{
+    SDL_GetWindowSize(window-&gt;internal-&gt;window_handle,
+                      &amp;window-&gt;window_width,
+                      &amp;window-&gt;window_height);
+
+    SDL_Renderer* renderer = 
+        SDL_GetRenderer(window-&gt;internal-&gt;window_handle);
+
+    SDL_GetRendererOutputSize(renderer,
+                              &amp;window-&gt;pixel_buffer_width,
+                              &amp;window-&gt;pixel_buffer_height);
+}
+
+GameWindow* game_window_create(const char* title, int width, int height)
+{
+    uint32_t window_flags = SDL_WINDOW_RESIZABLE;
+    SDL_Window *sdl_window = SDL_CreateWindow(title,
+                                          SDL_WINDOWPOS_CENTERED,
+                                          SDL_WINDOWPOS_CENTERED,
+                                          width, height,
+                                          window_flags);
+
+    if (!sdl_window)
+    {
+        printf(&quot;failed to create window\n&quot;);
+        return 0;
+    }
+
+    uintptr_t window_and_internal_size = 
+        sizeof(GameWindow) + sizeof(GameWindowInternal);
+    GameWindow* game_window = malloc(window_and_internal_size);
+    game_window-&gt;internal = (GameWindowInternal*)(game_window + 1);
+    game_window-&gt;internal-&gt;window_handle = sdl_window;
+    game_window-&gt;internal-&gt;surface = 0;
+
+    game_window-&gt;window_width = width;
+    game_window-&gt;window_height = height;
+    game_window-&gt;pixel_buffer_width = 0;
+    game_window-&gt;pixel_buffer_height = 0;
+    game_window-&gt;pixels = 0;
+    game_window-&gt;flags = GAME_WINDOW_FLAGS_NONE;
+
+    return game_window;
+}
+
+void game_window_destroy(GameWindow* game_window)
+{
+    SDL_DestroyWindow(game_window-&gt;internal-&gt;window_handle);
+    game_window-&gt;internal-&gt;window_handle = 0;
+
+    free(game_window);
+}
+
+void game_window_process_events(GameWindow* game_window)
+{
+    SDL_Event event;
+    while(SDL_PollEvent(&amp;event))
+    {
+        switch(event.type)
+        {
+            case SDL_WINDOWEVENT:
+                if (event.window.event == SDL_WINDOWEVENT_SHOWN) {
+                    game_window_update_size(game_window);
+                }
+                if (event.window.event == SDL_WINDOWEVENT_RESIZED) {
+                    game_window_update_size(game_window);
+                }
+                break;
+            case SDL_QUIT:
+                game_window-&gt;flags |= GAME_WINDOW_FLAGS_CLOSED;
+                break;
+        }
+    }
+}
+
+void game_window_surface_lock_pixels(GameWindow* game_window)
+{
+    SDL_Surface *surface = 
+        SDL_GetWindowSurface(game_window-&gt;internal-&gt;window_handle);
+    
+    SDL_LockSurface(surface);
+
+    game_window-&gt;internal-&gt;surface = surface;
+    game_window-&gt;pixels = surface-&gt;pixels;
+}
+
+void game_window_surface_unlock_and_update_pixels(GameWindow* game_window)
+{
+    game_window-&gt;pixels = 0;
+
+    SDL_UnlockSurface(game_window-&gt;internal-&gt;surface);
+    SDL_UpdateWindowSurface(game_window-&gt;internal-&gt;window_handle);
+}
new file   src/game_window.h
@@ -0,0 +1,30 @@
+// game_window.h
+
+#ifndef GAME_WINDOW_INCLUDED
+#define GAME_WINDOW_INCLUDED
+
+#include &lt;stdint.h&gt;
+
+typedef struct GameWindow {
+    int32_t window_width;
+    int32_t window_height;
+    int32_t pixel_buffer_width;
+    int32_t pixel_buffer_height;
+    uint8_t flags;
+    uint8_t *pixels;
+
+    struct GameWindowInternal* internal;
+} GameWindow;
+
+enum GameWindowFlags {
+    GAME_WINDOW_FLAGS_NONE = 0,
+    GAME_WINDOW_FLAGS_CLOSED = 1 &lt;&lt; 0,
+};
+
+GameWindow* game_window_create();
+void game_window_destroy(GameWindow *game_window);
+void game_window_process_events(GameWindow *game_window);
+void game_window_surface_lock_pixels(GameWindow *game_window);
+void game_window_surface_unlock_and_update_pixels(GameWindow *game_window);
+
+#endif // GAME_WINDOW_INCLUDED
\ No newline at end of file
deleted    src/hello_world.c
@@ -1,8 +0,0 @@
-#include &lt;stdio.h&gt;
-
-int main(int argc, char* argv[]) 
-{
-    printf(&quot;Hello, World!\n&quot;);
-
-    return 0;
-}
new file   src/main.c
@@ -0,0 +1,42 @@
+// main.c
+
+#include &lt;SDL2/SDL.h&gt;
+
+#include &quot;game_window.h&quot;
+
+int main(int argc, char* argv[])
+{
+    if (SDL_Init(SDL_INIT_VIDEO) &lt; 0)
+    {
+        printf(&quot;failed initializing SDL2\n&quot;);
+        return -1;
+    }
+
+    GameWindow* game_window = 
+        game_window_create(&quot;back_to_basics&quot;, 680, 480);
+
+    while ((game_window-&gt;flags &amp; GAME_WINDOW_FLAGS_CLOSED) == 0)
+    {
+        game_window_process_events(game_window);
+
+        game_window_surface_lock_pixels(game_window);
+
+        uint32_t *pixels_32bpp = (uint32_t *)game_window-&gt;pixels;
+        for (int y = 0; y &lt; game_window-&gt;pixel_buffer_height; y++)
+        {
+            uint32_t row = y * game_window-&gt;pixel_buffer_width;
+            for (int x = 0; x &lt; game_window-&gt;pixel_buffer_width; x++)
+            {
+                pixels_32bpp[x + row] = 0xff0000ff;
+            }
+        }
+
+        game_window_surface_unlock_and_update_pixels(game_window);
+
+        SDL_Delay(10);
+    }
+
+    SDL_Quit();
+
+    return 0;
+}
</code></pre>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../2_build_system/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 2. Build System" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              2. Build System
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
    
  </body>
</html>